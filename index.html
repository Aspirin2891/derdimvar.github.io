<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dertle≈ü ve Derman Bul</title>

<style>
body { margin:0; font-family:Arial; background:#f4f6f9; }
header { background:linear-gradient(90deg,#ff7a00,#0066cc); color:white; padding:25px; text-align:center; }
nav { background:white; padding:15px 30px; display:flex; justify-content:space-between; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
.container { max-width:1000px; margin:30px auto; padding:20px; }
.card { background:white; padding:20px; margin-bottom:20px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.05); cursor:pointer;}
.card:hover { background:#f2f2f2; }
button { background:#0066cc; color:white; padding:10px 15px; border:none; border-radius:6px; cursor:pointer;}
button:hover{ background:#004999;}
input,textarea{ width:100%; padding:10px; margin-bottom:10px; border-radius:8px; border:1px solid #ccc;}
.topic{ padding:10px; border-bottom:1px solid #eee; cursor:pointer;}
.topic:hover{ background:#f2f2f2;}
.reply{ padding:8px; border-bottom:1px solid #eee;}
.hidden{ display:none;}
</style>
</head>
<body>

<header>
<h1>Dertle≈ü ve Derman Bul</h1>
</header>

<nav>
  <div id="userArea"></div>
  <div id="authButtons">
    <button onclick="showLogin()">Giri≈ü</button>
    <button onclick="showRegister()">Kayƒ±t Ol</button>
  </div>
</nav>

<div class="container">
<div id="authBox" class="card hidden">
  <h3 id="authTitle">Giri≈ü Yap</h3>
  <input type="email" id="authEmail" placeholder="Email">
  <input type="password" id="authPassword" placeholder="≈ûifre">
  <button id="authAction">Devam Et</button>
</div>
<div id="categoriesSection">
<h2>Kategoriler</h2>
<div id="categories"></div>
</div>

<div id="topicsSection" class="hidden">
<button onclick="goBack()">‚Üê Geri</button>
<h2 id="categoryTitle"></h2>

<div id="topicsList"></div>

<div id="createTopicBox" style="margin-top:20px;">
<h3>Yeni Konu A√ß</h3>
<input type="text" id="topicTitle" placeholder="Konu ba≈ülƒ±ƒüƒ±">
<textarea id="topicContent" placeholder="Detaylƒ± anlat..."></textarea>
<button id="createTopic">Konu Olu≈ütur</button>
</div>
</div>

<div id="topicDetail" class="hidden">
<button onclick="backToTopics()">‚Üê Geri</button>
<h2 id="detailTitle"></h2>
<p id="detailContent"></p>

<h3>Yanƒ±tlar</h3>
<div id="replies"></div>

<textarea id="replyText" placeholder="Cevap yaz..."></textarea>
<button id="sendReply">Yanƒ±t G√∂nder</button>
</div>

</div>

<script type="module">

/* üîπ 1Ô∏è‚É£ T√úM IMPORTLAR EN √úSTTE */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";

import { 
  getAuth, 
  onAuthStateChanged, 
  signInWithEmailAndPassword,
  createUserWithEmailAndPassword,
  signOut
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import { 
  getDatabase,
  ref,
  set,
  onValue,
  push
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* üîπ 2Ô∏è‚É£ FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyAllhg1GM46bF9KKGv2t20uBb4xMSaEMnQ",
  authDomain: "derdimvar-c0642.firebaseapp.com",
  databaseURL: "https://derdimvar-c0642-default-rtdb.europe-west1.firebasedatabase.app/",
  projectId: "derdimvar-c0642",
  storageBucket: "derdimvar-c0642.appspot.com",
  messagingSenderId: "113627224046",
  appId: "1:113627224046:web:1aae2416c21916d1b560ff"
};


/* üîπ 3Ô∏è‚É£ APP BA≈ûLAT */
const app = initializeApp(firebaseConfig);

/* üîπ 4Ô∏è‚É£ AUTH VE DATABASE OLU≈ûTUR */
const auth = getAuth(app);
const db = getDatabase(app);


/* üîπ 5Ô∏è‚É£ AUTH UI KODLARI */
let authMode = "login";

window.showLogin = function(){
  authMode = "login";
  authTitle.innerText = "Giri≈ü Yap";
  authBox.classList.remove("hidden");
};

window.showRegister = function(){
  authMode = "register";
  authTitle.innerText = "Kayƒ±t Ol";
  authBox.classList.remove("hidden");
};

authAction.onclick = async () => {
  const email = authEmail.value;
  const password = authPassword.value;

  try{
    if(authMode === "login"){
      await signInWithEmailAndPassword(auth, email, password);
      alert("Giri≈ü ba≈üarƒ±lƒ±!");
    } else {
      await createUserWithEmailAndPassword(auth, email, password);
      alert("Kayƒ±t ba≈üarƒ±lƒ±!");
    }

    authBox.classList.add("hidden");
    authEmail.value="";
    authPassword.value="";
  }catch(error){
    alert("Hata: " + error.message);
  }
};

onAuthStateChanged(auth, user => {
  if(user){
    userArea.innerHTML = `
      ${user.email}
      <button onclick="logout()">√áƒ±kƒ±≈ü</button>
    `;
    authButtons.style.display="none";
  }else{
    userArea.innerText="Giri≈ü yapƒ±lmadƒ±";
    authButtons.style.display="block";
  }
});

window.logout = async function(){
  await signOut(auth);
  alert("√áƒ±kƒ±≈ü yapƒ±ldƒ±");
};

/* ƒ∞lk a√ßƒ±lƒ±≈üta kategorileri olu≈ütur */
set(ref(db,"categories/dertlesme"),{name:"Dertle≈üme"});
set(ref(db,"categories/tamirat"),{name:"Tamirat"});
set(ref(db,"categories/kendinyap"),{name:"Kendin Yap"});

/* Kategorileri Listele */
onValue(ref(db,"categories"), snapshot=>{
  const data = snapshot.val();
  categories.innerHTML="";
  for(let id in data){
    categories.innerHTML+=`
      <div class="card" onclick="openCategory('${id}','${data[id].name}')">
        ${data[id].name}
      </div>
    `;
  }
});

window.openCategory=function(id,name){
  currentCategory=id;
  categoryTitle.innerText=name;
  categoriesSection.classList.add("hidden");
  topicsSection.classList.remove("hidden");
};

/* Konu olu≈ütur */
createTopic.onclick=()=>{
  if(!auth.currentUser) return alert("Giri≈ü yapmalƒ±sƒ±n!");

  push(ref(db,"topics"),{
    category: currentCategory,
    title: topicTitle.value,
    content: topicContent.value,
    author: auth.currentUser.email
  });

  topicTitle.value="";
  topicContent.value="";
};

/* Konularƒ± Listele */
onValue(ref(db,"topics"), snapshot=>{
  const data = snapshot.val();
  topicsList.innerHTML="";
  if(!data) return;

  for(let id in data){
    if(data[id].category===currentCategory){
      topicsList.innerHTML+=`
        <div class="topic" onclick="openTopic('${id}')">
          <strong>${data[id].title}</strong><br>
          <small>${data[id].author}</small>
        </div>
      `;
    }
  }
});

window.openTopic=function(id){
  currentTopicId=id;
  topicsSection.classList.add("hidden");
  topicDetail.classList.remove("hidden");

  onValue(ref(db,"topics/"+id), snapshot=>{
    const data=snapshot.val();
    detailTitle.innerText=data.title;
    detailContent.innerText=data.content;
    replies.innerHTML="";
    if(data.replies){
      for(let r in data.replies){
        replies.innerHTML+=`
          <div class="reply">
            <strong>${data.replies[r].author}</strong><br>
            ${data.replies[r].text}
          </div>
        `;
      }
    }
  });
};

sendReply.onclick=()=>{
  if(!auth.currentUser) return alert("Giri≈ü yapmalƒ±sƒ±n!");

  push(ref(db,"topics/"+currentTopicId+"/replies"),{
    text: replyText.value,
    author: auth.currentUser.email
  });

  replyText.value="";
};

window.goBack=function(){
  topicsSection.classList.add("hidden");
  categoriesSection.classList.remove("hidden");
};

window.backToTopics=function(){
  topicDetail.classList.add("hidden");
  topicsSection.classList.remove("hidden");
};

</script>

</body>
</html>
